{% extends "base.html" %}
{% block title %}Panel de propietario{% endblock %}

{% block content %}
<h1>Panel de propietario</h1>
<p>Bienvenido. Aquí puedes revisar el estado de tus inmuebles, pagos e incidencias.</p>

<section>
  <div class="grid">
    <div class="card">
      <div class="muted">Inmuebles</div>
      <div class="stat">{{ stats.inmuebles }}</div>
    </div>
    <div class="card">
      <div class="muted">Contratos</div>
      <div class="stat">{{ stats.contratos }}</div>
    </div>
    <div class="card">
      <div class="muted">Pagos pendientes</div>
      <div class="stat">{{ stats.pagos_pendientes }}</div>
    </div>
    <div class="card">
      <div class="muted">Incidencias abiertas</div>
      <div class="stat">{{ stats.incidencias_abiertas }}</div>
    </div>
  </div>
</section>

<section>
  <h2>Mis inmuebles</h2>
  <div class="grid">
    {% for i in inmuebles %}
      <div class="card">
        <h3 style="margin:0 0 .25rem 0;">{{ i }}</h3>
        <div class="muted">{{ i.metros }} m²{% if i.habitaciones %} · {{ i.habitaciones }} hab.{% endif %}</div>
        <div style="margin-top:.5rem;">
          <a class="btn" href="{% url 'core:inmueble_detail' i.pk %}">Ver</a>
          <a class="btn" href="{% url 'core:inmueble_update' i.pk %}">Editar</a>
        </div>
      </div>
    {% empty %}
      <p>No tienes inmuebles asociados actualmente.</p>
    {% endfor %}
  </div>
</section>

<section>
  <div class="grid">
    <div class="card">
      <h2 style="margin-top:0;">Pagos recientes</h2>
      <ul class="list">
        {% for p in pagos %}
          <li>
            <strong>{{ p.fecha|date:"Y-m-d" }}</strong> · {{ p.tipo }} · {{ p.total }} € ·
            <span class="badge {% if p.pagado %}ok{% else %}warn{% endif %}">{% if p.pagado %}Pagado{% else %}Pendiente{% endif %}</span>
            <div class="muted">{{ p.inmueble }}</div>
          </li>
        {% empty %}
          <li class="muted">No hay pagos registrados.</li>
        {% endfor %}
      </ul>
    </div>
    <div class="card">
      <h2 style="margin-top:0;">Incidencias recientes</h2>
      <ul class="list">
        {% for inc in incidencias %}
          <li>
            <strong>{{ inc.inmueble }}</strong>
            <div class="muted">{{ inc.fecha_reporte|date:"Y-m-d" }} · {{ inc.estado }}</div>
            <div>{{ inc.descripcion|truncatechars:120 }}</div>
          </li>
        {% empty %}
          <li class="muted">No hay incidencias.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
</section>

<section>
  <h2>Contratos</h2>
  <ul class="list">
    {% for c in contratos %}
      <li>
        <strong>{{ c.inmueble }}</strong> · {{ c.fecha_inicio|date:"Y-m-d" }} → {% if c.fecha_fin %}{{ c.fecha_fin|date:"Y-m-d" }}{% else %}abierto{% endif %}
        <div class="muted">Inquilinos: {% for i in c.inquilinos.all %}{{ i.nombre }}{% if not forloop.last %}, {% endif %}{% endfor %}</div>
      </li>
    {% empty %}
      <li class="muted">No hay contratos registrados.</li>
    {% endfor %}
  </ul>
</section>
{% endblock %}
